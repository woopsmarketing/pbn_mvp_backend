# v1.0 - Celery ì›Œì»¤ ì„œë¹„ìŠ¤ìš© Dockerfile (2024.07.03)
# í•œê¸€ ì£¼ì„: Celery ì›Œì»¤ ì»¨í…Œì´ë„ˆ ë¹Œë“œ ë° ì‹¤í–‰ìš© Dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

# ğŸ”§ í´ë¼ìš°ë“œ í™˜ê²½ ìµœì í™”ëœ Celery Worker ì‹œì‘ ëª…ë ¹ì–´
# - concurrency=1: ì»¨í…Œì´ë„ˆ í™˜ê²½ì—ì„œ ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ ì‚¬ìš©
# - queues: ëª¨ë“  í ì²˜ë¦¬ (default,email,pbn,reports)
# - loglevel=info: í•µì‹¬ ì •ë³´ë§Œ ì¶œë ¥ (debug ë¡œê·¸ ì œê±°)
# - without-gossip: ë¶„ì‚° í™˜ê²½ì—ì„œ ë¶ˆí•„ìš”í•œ gossip ë¹„í™œì„±í™”
# - without-mingle: Workerê°„ ë™ê¸°í™” ë¹„í™œì„±í™” (ë‹¨ì¼ Workerì‹œ)
# - pool=solo: ë‹¨ì¼ ìŠ¤ë ˆë“œ pool ì‚¬ìš© (ì•ˆì •ì„± í–¥ìƒ)
CMD ["celery", "-A", "app.tasks.celery_app", "worker", \
     "--loglevel=info", \
     "--concurrency=1", \
     "--queues=default,email,pbn,reports", \
     "--without-gossip", \
     "--without-mingle", \
     "--pool=solo"] 